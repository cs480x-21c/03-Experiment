<script src="https://d3js.org/d3.v4.min.js"></script>

<script src="https://unpkg.com/d3-horizon-chart"></script>

<style>
</style>

<body>
  <p id='label' style="font-size:50px">Horizon Chart</p>
    <svg id="axis" height="10" width="500"></svg>
    <div id="wrapper">
    </div>
</body>

<script>
  //console.log(d3); // test if d3 is loaded

  makeChart(d3.select('axis'), 500, 500, 20, 100,'trialValues.csv',22);

  // http://kmandov.github.io/d3-horizon-chart/
  function makeChart(svg, width, height, xRange, yRange, fileName, chartNum) {

    const margin = {top: 20, right: 10, bottom: 0, left: 10};
    const w = width - margin.left - margin.right,
            h = 50 - margin.top - margin.bottom;

    const g = d3.select("body").append("svg")
            .attr("width", w + margin.left + margin.right)
            .attr("height", h + margin.top + margin.bottom)
            .append("g")
            .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

    let numSets = (Math.floor(chartNum / 10) + 1) * 2;
    let colNums = [], mark = [];
    if (chartNum < 10) {
      colNums = [2 * chartNum, 2 * chartNum + 1];
      mark = [...colNums]
    }
    else if (chartNum < 20) {
      let i = chartNum - 10;
      colNums = [20 + 4 * i, 21 + 4 * i, 22 + 4 * i, 23 + 4 * i];
      mark = [20 + 4 * i, 21 + 4 * i + chartNum % 3]
    }
    else {
      let i = chartNum - 20;
      colNums = [60 + 6 * i, 61 + 6 * i, 62 + 6 * i, 63 + 6 * i, 64 + 6 * i, 65 + 6 * i];
      mark = [60 + 6 * i, 61 + 6 * i + chartNum % 5]
    }

    // Add X axis
    let x = d3.scaleLinear()
            .domain([0, xRange])
            .range([0, w]);

    let xAxis = d3.axisBottom(x)
    xAxis.tickValues([0, 5, 10, 15, xRange])

    g.append("g")
            //.attr("transform", "translate(0," + height + ")")
            .call(xAxis);

    d3.csv(fileName, function (data) {
      let cols = data.columns;
      let yCols = colNums;
      var series = [];
      for (var i = 0; i < numSets; i++) {
        series.push(data.map(function (d) {
          return parseFloat(d[cols[yCols[i]]])
        }))
      }

      var horizonChart = d3.horizonChart()
              .height(height / 6)
              .step(width / xRange)
              .extent([0,yRange])
              .colors(['#313695', '#4575b4', '#74add1', '#abd9e9',
                '#fee090', '#fdae61', '#f46d43', '#d73027']);

      var horizons = d3.select('body').selectAll('.horizon')
              .data(series)
              .enter().append('div')
              .attr('class', 'horizon')
              .each(horizonChart);
    });
  }



</script>
