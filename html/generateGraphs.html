<head>
  <title>Experiment Graphs</title>
</head>


<body>
  <header>
    <textarea id="tracker"></textarea>
  </header>
  <script src="https://d3js.org/d3.v4.min.js"></script>

  <svg id="vis"> </svg>
  <p>This is a paragraph explaining what is the graph
    and THE QUESTION
  </p>
  <form>
    <fieldset>
      <label>THE QUESTION </label>
      <input type="text" id="txtAnswer" />
      <input type="button" value="Save, Next" onclick="saveNext()" />
    </fieldset>
  </form>

  <script>
    console.log(d3); // test if d3 is loaded

    //Setup
    var tracker = 6;
    var trackerMax = 6;
    var track = document.getElementById('tracker');
    track.value = tracker + "/" + trackerMax;

    var filepath = 'data.csv';
    var data = [{
      "participantID": 'elene',
      "trialNum": 0,
      "vis": 'bar',
      "truePercent": 75,
      "reportedPercent": 65
    }, {
      "participantID": 'elene',
      "trialNum": 0,
      "vis": 'bar',
      "truePercent": 75,
      "reportedPercent": 65
    }];
    var csvData = new Array();
    csvData.push('"participantID","trialNum","vis","truePercent","reportedPercent"\n"');

    function appendCSV() {
      data.forEach(function (item, index, array) {
        csvData.push(item.participantID + '","' + item.trialNum + '","' + item.vis + '","' + item.truePercent + '","' + item.reportedPercent + '"\n"');
      });

    }

    function end() {
      console.log("end");
      //write data to csv
      appendCSV();
      let csvContent = "data:text/csv;charset=utf-8 , " + csvData; //.map(e => e.join(",")).join("\n");

      var encodedUri = encodeURI(csvContent);
      var link = document.createElement("a");
      link.setAttribute("href", encodedUri);
      link.setAttribute("download", "my_data.csv");
      document.body.appendChild(link);
      link.click();
    }

    console.log(d3); // test if d3 is loaded

    //We might have to consider the margins
    var width = 500, height = 500;

    var svg = d3.select('#vis')
      .attr('width', 500)
      .attr('height', 500);
    //.append('g');   Depending on the graph we might have to append this within
    //                within the local function to make sure the graph is good 


    //READ IN THE DATA
    //var data = .....;

    function increaseTrack() {
      console.log("incr");
      track = document.getElementById('tracker');
      tracker = tracker + 1;
      if (tracker > trackerMax) {
        end();
      } else {
        track.value = tracker + "/" + trackerMax;
      }
    }

    var svg = d3.select('#vis')
      .attr('width', 500)
      .attr('height', 500);

    function generateRandomNumber() {
      console.log("random");
    }

    function generateBarGraph() {
      console.log("bar");

      //xaxis
      var x = d3.scaleBand()
        .range([0, width]);
      //.domain(data.map(function(d) { return d.(xaxis data); }))
      svg.append('g')
        .attr('transform', 'translate(0,' + height + ')')
        .call(d3.axisBottom(x))
        .selectAll('text')
        .attr('transform', 'translate(-10,0)rotate(-45)')
        .style('text-anchor', 'end');

      //yaxis
      var y = d3.scaleLinear()
        //.domain([num, num]) 
        .range([heightt, 0]);
      svg.append('g')
        .call(d3.axisLeft(y));

      //barchart plotting data
      svg.selectAll('mybar')
        //.data(data)
        .enter()
        .append('rect')
        //.attr('x', function(d) { return x(d.(xaxisdata)); })
        //.attr('y', function(d) { return y(d.(yaxisdata)); })
        .attr('width', x.bandwidth())
        //.attr('height', function(d) { return height - y(d.(yaxisdata)); })
        .attr('stroke', 'black')
        .style('stroke-width', '2px');
      //we might have to add a dot maybe within the two random bars?
    }
    function generatePieChart() {
      console.log("pie");

      //Radius of pie chart is half the length of the width or height
      var radius = width / 2;

      //Setting the color scale
      var color = d3.scaleOrdinal();
      //.domain(data)
      //.range([is this just white?])

      var pie = d.pie();
      //.value(function(d) { return d.(ymeasureabledata); })

      //We graph this variable of data entries
      //var data_ready = pie.(d3.entries(data));

      svg.selectAll('mypie')
        //.data(data_ready)
        .enter()
        .append('path')
        //We have to graph each arc of the data point
        .attr('d', d3.arc()
          .innerRadius(0)
          .outerRadius(radius))
        .attr('stroke', 'black')
        .style('stroke-width', '2px');
      //we might have to add the dot?
    }

    function generateStackedBarChart() {
      console.log("Stacked");
      //After we read in the data, we have to list the subgroups to be stacked
      var subgroups = data.columns.slice(1);

      //The first column here is set to be the x axis with the subgroups being the stacked bars
      var groups  = d3.map(data, function(d){ return(d.(/*first column name*/)); }).keys()

      //xaxis
      var x = d3.scaleBand()
                .domain(groups)
                .range([0, width]);
        
      svg.append('g')
        .attr('transform', 'translate(0,' + height + ')')
        .call(d3.axisBottom(x).tickSizeOuter(0));

      //yaxis
      var y = d3.scaleLinear()
                //.domain([num, num])
                .range([height, 0]);
      svg.append('g')
        .call(d3.axisLeft(y));

      //color?? --> Would we need to add color here to differentiate the different subgroups?

      var stackedData = d3.stack()
                          .keys(subgroups)(data);
      
      svg.append('g')
        .selectAll('g')
        .data(stackedData)
        .enter().append('g')
          //we would add the color here...
          .selectAll('rect')
          //we'd have to enter() more times depending on the subgroups to add all the necessary rectangles
          .data(function(d) { return d; })
          .enter().append('rect')
            .attr('x', function(d) { return x(d.data./*first column name*/)})
            .attr('y', function(d) { return y(d[1]); })
            .attr('height', function(d) { return y(d[0]-y(d[1])); })
            .attr('width', x.bandwidth());

    }

    function displayRandomGraph() {
      console.log("Display Random Graph");
      //save data
    }

    function saveNext() {
      displayRandomGraph();
      increaseTrack();
    }
  </script>

</body>